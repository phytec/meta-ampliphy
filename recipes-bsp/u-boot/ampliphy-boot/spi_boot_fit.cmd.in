if itest.s ${devtype} != spi_flash; then
	echo "ERROR: Invalid boot script for devtype ${devtype}, expected spi_flash! Exiting..."
	exit
fi

test -n ${fit_addr_r} && env set loadaddr ${fit_addr_r}
env set bootargs "console=${console} earlycon=${earlycon} ${optargs}"
env set mtdparts @@SPI_MTD_PARTS@@
mtd list
mtd read fitimage ${loadaddr}

# Load default configuration
fdt address ${loadaddr};
fdt get value fit_default_conf /configurations/ default;

if test -n ${fit_overlay_conf}; then
	bootm ${loadaddr}#${fit_default_conf}${fit_extensions}#${fit_overlay_conf}
else
	bootm ${loadaddr}#${fit_default_conf}${fit_extensions}
fi
